[gd_scene load_steps=8 format=2]

[ext_resource path="res://Resources/Anarchy/Textures/Icons/rating/Downvote.png" type="Texture2D" id=1]
[ext_resource path="res://Resources/Anarchy/Textures/Icons/rating/Upvote.png" type="Texture2D" id=2]
[ext_resource path="res://Resources/Anarchy/Textures/Icons/rating/Favorite.png" type="Texture2D" id=3]
[ext_resource path="res://Resources/Anarchy/Fonts/spacemono_regular_minimal.tres" type="FontFile" id=4]
[ext_resource path="res://Resources/Anarchy/Fonts/spacemono_bold_minimal.tres" type="FontFile" id=5]
[ext_resource path="res://Resources/Anarchy/Scenes/UIElements/SmartIcon.gd" type="Script" id=6]

[sub_resource type="GDScript" id=30]
script/source = "extends Button

enum {NONE = 0, SUBSCRIBED = 1, LEGACY = 2, INSTALLED = 4, UPDATE = 8, DOWNLOADING = 16, PENDING = 32}

var id: int
var item: Dictionary

func set_item(i: Dictionary):
	item = i
	id = item.file_id
	item.subscribed = bool(SteamAPI.singleton.getItemState(id) & SUBSCRIBED)
	set_subscribed(item.subscribed)
	
	var nick = SteamAPI.get_nick(item.steam_id_owner)
	if nick == \"\":
		set_title(item.title, \"...\")
		get_tree().create_timer(1).connect(\"timeout\", Callable(self, \"reload_nick\").bind(item.steam_id_owner))
	else:
		reload_nick(item.steam_id_owner)
	
	set_upvotes(str(item.votes_up))
	set_downvotes(str(item.votes_down))

func reload_nick(idx: int):
	set_title(item.title, SteamAPI.get_nick(idx))

func clear():
	set_title(\"\", \"\")
	set_upvotes(\"--\")
	set_downvotes(\"--\")
	set_subscribed(false)
	item = {}

func set_title(title: String, author: String):
	if title.is_empty():
		$RichTextLabel.text = \"\"
	else:
		$RichTextLabel.text = \"%s [color=#%s] %s\" % [title, Const.UI_SECONDARY_COLOR.to_html(false), tr(\"by: %s\") % author]

func set_upvotes(c: String):
	$\"%UpvoteNumber\".text = c

func set_downvotes(c: String):
	$\"%DownvoteNumber\".text = c

func set_subscribed(s: bool):
	$\"%FavIcon\".visible = s
"

[node name="WorkshopMap" type="Button"]
unique_name_in_owner = true
offset_right = 1404.0
offset_bottom = 72.0
size_flags_horizontal = 3
size_flags_vertical = 0
theme_type_variation = "WorkshopMapButton"
theme_override_colors/font_focus_color = Color( 1, 1, 1, 1 )
theme_override_colors/font_color = Color( 1, 0.721569, 0, 1 )
theme_override_colors/font_hover_color = Color( 1, 1, 1, 1 )
theme_override_colors/font_pressed_color = Color( 0, 0, 0, 1 )
theme_override_fonts/font = ExtResource( 5 )
align = 0
script = SubResource( 30 )

[node name="RichTextLabel" type="RichTextLabel" parent="."]
anchor_bottom = 1.0
offset_left = 8.0
offset_right = 1083.0
mouse_filter = 2
theme_override_fonts/normal_font = ExtResource( 5 )
bbcode_enabled = true
text = "Map Name Long / AuthName"
text = "Map Name Long / AuthName"
scroll_active = false

[node name="Raiting" type="HBoxContainer" parent="."]
anchor_left = 1.0
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
offset_left = -298.0
offset_top = -27.5
offset_right = -14.0
offset_bottom = 27.5
size_flags_vertical = 7
alignment = 2

[node name="Upvote" type="TextureRect" parent="Raiting"]
self_modulate = Color( 1, 0.721569, 0, 1 )
offset_right = 24.0
offset_bottom = 55.0
custom_minimum_size = Vector2( 24, 25 )
texture = ExtResource( 2 )
expand = true
stretch_mode = 6
script = ExtResource( 6 )

[node name="UpvoteNumber" type="Label" parent="Raiting"]
unique_name_in_owner = true
offset_left = 28.0
offset_right = 126.0
offset_bottom = 55.0
theme_override_fonts/font = ExtResource( 4 )
text = "9999"

[node name="Downvote" type="TextureRect" parent="Raiting"]
self_modulate = Color( 1, 0.721569, 0, 1 )
offset_left = 130.0
offset_right = 154.0
offset_bottom = 55.0
custom_minimum_size = Vector2( 24, 25 )
texture = ExtResource( 1 )
expand = true
stretch_mode = 6
script = ExtResource( 6 )

[node name="DownvoteNumber" type="Label" parent="Raiting"]
unique_name_in_owner = true
offset_left = 158.0
offset_right = 256.0
offset_bottom = 55.0
theme_override_fonts/font = ExtResource( 4 )
text = "9999"

[node name="FavIcon" type="TextureRect" parent="Raiting"]
unique_name_in_owner = true
self_modulate = Color( 1, 0.721569, 0, 1 )
offset_left = 260.0
offset_right = 284.0
offset_bottom = 55.0
custom_minimum_size = Vector2( 24, 25 )
texture = ExtResource( 3 )
expand = true
stretch_mode = 6
script = ExtResource( 6 )
