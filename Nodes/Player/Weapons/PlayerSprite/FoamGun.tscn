[gd_scene load_steps=6 format=2]

[ext_resource path="res://Nodes/Map/ZIndexer.tscn" type="PackedScene" id=1]
[ext_resource path="res://Nodes/Player/Weapons/PlayerSprite/Foam.gd" type="Script" id=2]
[ext_resource path="res://SFX/Pickups/foam_release.wav" type="AudioStream" id=3]
[ext_resource path="res://Nodes/Player/Weapons/Tools/FoamGun.png" type="Texture2D" id=4]

[sub_resource type="GDScript" id=13]
script/source = "extends Node2D

@onready var foam := $Foam
@onready var sound=$\"AudioStreamPlayer2D\"
@onready var shoot_point=$ShootPoint
var player: Player

func set_player(p: Player):
	player = p


func _ready() -> void:
	foam.player = player
	remove_child(foam)
	Utils.game.map.add_child(foam)
	foam.global_transform = Transform2D.IDENTITY


func _exit_tree() -> void:
	foam.stop = true
	get_tree().create_timer(2).connect(\"timeout\", Callable(foam, \"queue_free\"))

var repair_cost=0.0


func put_away():
#	animator.play(\"PutAway\")
#	collider.disabled = true
	pass

func _physics_process(delta):
	if player.is_shooting() and not player.build_menu:
		foam.shoot_point=shoot_point.global_position
		foam.stop = false
		foam.set_physics_process(true)
		foam.set_process(true)
		if !sound.playing:
			sound.play(sound.stream.get_length()*randf())
		
		repair_cost+=0.1
		var foam_available=player.get_item_count(Const.ItemIDs.FOAM_GUN)
		player.subtract_item(Const.ItemIDs.FOAM_GUN, min(int(repair_cost), foam_available), null, true)
		if foam_available<repair_cost:
			queue_free()
		repair_cost-=int(repair_cost)
	else:
		foam.stop = true
		sound.stop()

	
"

[node name="FoamGun" type="Node2D"]
script = SubResource( 13 )

[node name="Sprite2D" type="Sprite2D" parent="."]
position = Vector2( -3, 1.759 )
scale = Vector2( 0.1, 0.1 )
texture = ExtResource( 4 )

[node name="Foam" type="Node2D" parent="."]
z_index = 599
z_as_relative = false
script = ExtResource( 2 )

[node name="ZIndexer" parent="Foam" instance=ExtResource( 1 )]
z_index = 600
offset = -1

[node name="ShootPoint" type="Node2D" parent="."]
position = Vector2( 12.5788, 0 )

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource( 3 )
pitch_scale = 1.67
bus = "SFX"
