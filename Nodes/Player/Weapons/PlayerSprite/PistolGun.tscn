[gd_scene load_steps=10 format=2]

[ext_resource path="res://Nodes/Player/Weapons/PlayerSprite/PistolGun.png" type="Texture2D" id=1]
[ext_resource path="res://Nodes/Player/Weapons/PlayerSprite/Bullet_count.png" type="Texture2D" id=2]
[ext_resource path="res://Nodes/Effects/MuzzleFlash/MuzzleFlash.tscn" type="PackedScene" id=3]
[ext_resource path="res://Nodes/Player/Weapons/PlayerSprite/PistolGun_top.png" type="Texture2D" id=4]

[sub_resource type="GDScript" id=13]
script/source = "extends \"res://Nodes/Player/Weapons/PlayerSprite/GunSprite.gd\"

@onready var progress: TextureProgressBar = get_node_or_null(\"Sprite2D/ProgressBar\")

#func _ready() -> void:
#	$LaserSight.global_rotation = player.get_shoot_rotation()

func shoot(bullet: Node2D):
	super.shoot(bullet)
#	reload()

func reload():
	var weapon: Dictionary = player.get_current_item()
	progress.max_value = player.get_upgraded(Const.Items[weapon.id], \"reload\")
	progress.value = progress.max_value + 1 - weapon.reload
"

[sub_resource type="Shader" id=14]
code = "shader_type canvas_item;

uniform sampler2D noise;
uniform float ray_length = 300;
uniform float noise_scale = 5;

uniform vec4 ray_color :source_color = vec4(1.0,0.0,0.0,1.0);

void fragment() {
	float noise_tex = texture(noise, vec2(SCREEN_UV.x*noise_scale+TIME *0.2, SCREEN_UV.y*noise_scale+TIME *0.2)).r;
	COLOR.a = 2.0 * noise_tex * (1.0-UV.x * ray_length/300.0 ) * ray_color.a;
//	COLOR.a = (max(0.0, snoise( vec3( SCREEN_UV*50.0, TIME*2.0 ) ))*0.5 + 0.3) * (1.0-UV.x);
	COLOR.rgb = ray_color.rgb;
}
"

[sub_resource type="FastNoiseLite" id=11]
period = 8.5
persistence = 0.0
lacunarity = 0.1

[sub_resource type="NoiseTexture" id=15]
width = 128
height = 128
seamless = true
bump_strength = 13.5
noise = SubResource( 11 )

[sub_resource type="ShaderMaterial" id=12]
shader = SubResource( 14 )
shader_param/ray_length = 300.0
shader_param/noise_scale = 15.0
shader_param/ray_color = Color( 0, 1, 0.439216, 0.509804 )
shader_param/noise = SubResource( 15 )

[node name="PistolGun" type="Node2D"]
script = SubResource( 13 )

[node name="LaserSight" type="Line2D" parent="."]
unique_name_in_owner = true
show_behind_parent = true
material = SubResource( 12 )
position = Vector2( 10, 0 )
points = PackedVector2Array( 0, 0, 100, 0 )
width = 1.0
texture_mode = 2

[node name="Sprite2D" type="Sprite2D" parent="."]
position = Vector2( 4.62493, 0 )
scale = Vector2( 0.05, 0.05 )
texture = ExtResource( 1 )

[node name="ProgressBar" type="TextureProgressBar" parent="Sprite2D"]
modulate = Color( 2, 2, 2, 1 )
offset_left = -10.0
offset_top = -7.0
offset_right = 90.0
offset_bottom = 7.0
max_value = 6.0
value = 1.0
texture_progress = ExtResource( 2 )

[node name="ShootPoint" type="Node2D" parent="Sprite2D"]
position = Vector2( -56.5454, 0 )
scale = Vector2( 20, 20 )

[node name="MuzzleFlash" parent="Sprite2D/ShootPoint" instance=ExtResource( 3 )]
position = Vector2( 11.1512, 0 )
scale = Vector2( 0.25, 0.25 )

[node name="Sprite2" type="Sprite2D" parent="."]
position = Vector2( 1, 0 )
scale = Vector2( 0.05, 0.05 )
z_index = 1
texture = ExtResource( 4 )
offset = Vector2( -2.5, 1 )
region_rect = Rect2( 60, 0, 92, 88 )
