[gd_scene load_steps=5 format=2]

[ext_resource path="res://Nodes/UI/Icons/ControlsUp.png" type="Texture2D" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends VBoxContainer

var scheme: int

signal scheme_changed

func _ready() -> void:
	$Label.text = tr(\"Player %s\") % (get_index() + 1)
	scheme = get_index()
	deselect()
	refresh()

func select():
	$Icon/TextureButton.show()
	$Icon/TextureButton2.show()

func deselect():
	$Icon/TextureButton.hide()
	$Icon/TextureButton2.hide()

func next_scheme():
	scheme = wrapi(scheme - 1, -1 if get_index() > 1 else 0, get_max_controls())
	refresh()
	emit_signal(\"scheme_changed\")

func prev_scheme():
	scheme = wrapi(scheme + 1, -1 if get_index() > 1 else 0, get_max_controls())
	refresh()
	emit_signal(\"scheme_changed\")

func refresh():
	match scheme:
		-1:
			$Icon.texture = preload(\"res://Nodes/UI/Icons/Controller_Disconnected.png\")
		0:
			$Icon.texture = preload(\"res://Nodes/UI/Icons/Keyboard&Mouse.png\")
		1:
			$Icon.texture = preload(\"res://Nodes/UI/Icons/Joypad1.png\")
		2:
			$Icon.texture = preload(\"res://Nodes/UI/Icons/Joypad2.png\")
		3:
			$Icon.texture = preload(\"res://Nodes/UI/Icons/Joypad3.png\")
		4:
			$Icon.texture = preload(\"res://Nodes/UI/Icons/Joypad4.png\")

func _notification(what: int) -> void:
	if what == NOTIFICATION_VISIBILITY_CHANGED:
		$AnimationPlayer.set_process_internal(is_visible_in_tree())

func get_max_controls() -> int:
	return min(Const.PLAYER_LIMIT + 1, 5) as int
"

[sub_resource type="Animation" id=2]
resource_name = "Active"
loop = true
tracks/0/type = "value"
tracks/0/path = NodePath("Icon/TextureButton:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PackedFloat32Array( 0, 0.5 ),
"transitions": PackedFloat32Array( 0.5, -2 ),
"update": 0,
"values": [ Vector2( 0, 0 ), Vector2( 0, -10 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("Icon/TextureButton2:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PackedFloat32Array( 0, 0.5 ),
"transitions": PackedFloat32Array( 0.5, -2 ),
"update": 0,
"values": [ Vector2( 0, 110 ), Vector2( 0, 120 ) ]
}

[sub_resource type="Animation" id=3]
length = 0.001
tracks/0/type = "value"
tracks/0/path = NodePath("Icon/TextureButton:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PackedFloat32Array( 0 ),
"transitions": PackedFloat32Array( 1 ),
"update": 0,
"values": [ Vector2( 0, 0 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("Icon/TextureButton2:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PackedFloat32Array( 0 ),
"transitions": PackedFloat32Array( 1 ),
"update": 0,
"values": [ Vector2( 0, 110 ) ]
}

[node name="ControlsSetup" type="VBoxContainer"]
offset_left = 326.0
offset_right = 466.0
offset_bottom = 167.0
script = SubResource( 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Label" type="Label" parent="."]
offset_right = 140.0
offset_bottom = 14.0
text = "Player %s"

[node name="Icon" type="TextureRect" parent="."]
offset_top = 18.0
offset_right = 140.0
offset_bottom = 158.0
custom_minimum_size = Vector2( 0, 140 )
stretch_mode = 4

[node name="TextureButton" type="TextureButton" parent="Icon"]
anchor_right = 1.0
offset_right = 2240.0
offset_bottom = 30.0
focus_mode = 0
texture_normal = ExtResource( 2 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="TextureButton2" type="TextureButton" parent="Icon"]
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_top = 110.0
offset_right = 2240.0
offset_bottom = 140.001
focus_mode = 0
texture_normal = ExtResource( 2 )
flip_v = true
__meta__ = {
"_edit_use_anchors_": false
}

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
autoplay = "Active"
anims/Active = SubResource( 2 )
anims/RESET = SubResource( 3 )

[connection signal="pressed" from="Icon/TextureButton" to="." method="prev_scheme"]
[connection signal="pressed" from="Icon/TextureButton2" to="." method="next_scheme"]
