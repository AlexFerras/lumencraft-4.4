[gd_scene load_steps=14 format=2]

[ext_resource path="res://Nodes/Buildings/Common/Computer/GenericComputer.tscn" type="PackedScene" id=1]
[ext_resource path="res://Nodes/Buildings/Icons/IconStorage.tscn" type="PackedScene" id=3]
[ext_resource path="res://Nodes/Buildings/InfoCenter/Info_Center.png" type="Texture2D" id=4]
[ext_resource path="res://Nodes/Buildings/InfoCenter/Info_Center_001.png" type="Texture2D" id=5]
[ext_resource path="res://Nodes/Buildings/InfoCenter/Info_Center_002.png" type="Texture2D" id=6]
[ext_resource path="res://Nodes/Buildings/Storage/storage_container_photo.png" type="Texture2D" id=7]
[ext_resource path="res://Nodes/Map/ZIndexer.tscn" type="PackedScene" id=8]
[ext_resource path="res://Nodes/Map/MapMarker/MapMarker.tscn" type="PackedScene" id=10]
[ext_resource path="res://Nodes/Map/LavaChecks.gd" type="Script" id=11]

[sub_resource type="GDScript" id=1]
script/source = "tool
extends Node2D

@export var open_photo_folder: bool: set = sopen_photo_folder
@export var frames: int = 1

@onready var lens = $Lens

func _ready() -> void:
	if Engine.is_editor_hint():
		return
	
	var viewport = SubViewport.new()
	
	var nodes = get_children()
	for node in nodes:
		if node is Node2D:
			remove_child(node)
			viewport.add_child(node)
			node.position -= lens.position
	
	viewport.transparent_bg = true
	viewport.render_target_v_flip = true
	viewport.usage = SubViewport.USAGE_2D
	viewport.render_target_update_mode = SubViewport.UPDATE_ALWAYS
	viewport.size = lens.size
	add_child(viewport)
	
	await RenderingServer.frame_post_draw
	
	DirAccess.new().make_dir_recursive(\"Tools/Photos\")
	
	if frames == 1:
		viewport.get_texture().get_data().save_png(\"res://Tools/Photos/Photo.png\")
		get_tree().quit()
	else:
		for i in frames:
			viewport.get_texture().get_data().save_png(\"res://Tools/Photos/Photo%s.png\" % i)
			propagate_call(\"next_frame\")
			await get_tree().process_frame
			await get_tree().process_frame
		get_tree().quit()

func sopen_photo_folder(o: bool):
	if o:
		OS.shell_open(ProjectSettings.globalize_path(\"res://Tools/Photos\"))
"

[sub_resource type="GDScript" id=18]
script/source = "extends ReferenceRect
tool

func _process(delta):
	if not Input.is_key_pressed(KEY_ALT):
		position = -size * 0.5
"

[sub_resource type="RectangleShape2D" id=17]
extents = Vector2( 12.1756, 27.0982 )

[sub_resource type="RectangleShape2D" id=19]
extents = Vector2( 22.7922, 15.8135 )

[node name="PhotoShop" type="Node2D"]
script = SubResource( 1 )

[node name="Lens" type="ReferenceRect" parent="."]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -243.0
offset_top = -187.0
offset_right = 243.0
offset_bottom = 187.0
pivot_offset = Vector2( 279, -42 )
script = SubResource( 18 )

[node name="InfoCenter" type="Area2D" parent="." groups=["info_center"]]
scale = Vector2( 4, 4 )
z_index = 600
z_as_relative = false
__meta__ = {
"range_expander_radius": 100.0
}

[node name="CollisionShape2D" type="CollisionShape2D" parent="InfoCenter"]
visible = false
position = Vector2( 0.246834, 1.0542 )
shape = SubResource( 17 )

[node name="CollisionShape2D2" type="CollisionShape2D" parent="InfoCenter"]
visible = false
position = Vector2( 0.172585, -2.06394 )
shape = SubResource( 19 )

[node name="range_visual" parent="InfoCenter" instance=ExtResource( 10 )]
visible = false
modulate = Color( 0.501961, 1, 1, 1 )
max_radius = 99999.0
circle_radius = 150.0

[node name="Sprite2D" type="Sprite2D" parent="InfoCenter"]
position = Vector2( -0.346, 0 )
scale = Vector2( 0.15, 0.15 )
texture = ExtResource( 4 )

[node name="Sprite2D" type="Sprite2D" parent="InfoCenter/Sprite2D"]
z_index = 3
texture = ExtResource( 5 )

[node name="InfoCenter002" type="Sprite2D" parent="InfoCenter/Sprite2D/Sprite2D"]
modulate = Color( 1.2, 1.2, 1.2, 1 )
texture = ExtResource( 6 )
offset = Vector2( 0, 50 )

[node name="info_computer" parent="InfoCenter" instance=ExtResource( 1 )]
position = Vector2( -0.16, 22.348 )
scale = Vector2( 0.5, 0.5 )
script = null

[node name="LavaChecks" type="Node2D" parent="InfoCenter"]
position = Vector2( -0.561863, 0.998871 )
script = ExtResource( 11 )

[node name="Marker2D" type="Marker2D" parent="InfoCenter/LavaChecks"]
position = Vector2( 24.8083, -2.20743 )

[node name="Position2D2" type="Marker2D" parent="InfoCenter/LavaChecks"]
position = Vector2( 0.0368733, 28.4235 )

[node name="Position2D3" type="Marker2D" parent="InfoCenter/LavaChecks"]
position = Vector2( -23.6186, -1.92978 )

[node name="Position2D4" type="Marker2D" parent="InfoCenter/LavaChecks"]
position = Vector2( 0.907818, -27.8527 )

[node name="ZIndexer" parent="InfoCenter" instance=ExtResource( 8 )]
z_index = 600

[node name="TerrainMask" type="Sprite2D" parent="InfoCenter"]
visible = false
self_modulate = Color( 1, 1, 1, 0.65098 )
position = Vector2( 0.0553213, -3.52577 )
scale = Vector2( 0.143073, 0.0879372 )
texture = ExtResource( 7 )

[node name="Socket" type="Node2D" parent="InfoCenter"]

[node name="Icon" parent="InfoCenter" instance=ExtResource( 3 )]
visible = false
